(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{269:function(e,t,n){e.exports=n(467)},466:function(e,t,n){},467:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(27),c=n.n(o),i=n(34),l=n(100),u=n(92),s=n(236),d=n(136),m=n(46),p=n(192),b=n.n(p),f=n(237),O=n(489),v=n(477),j=n(483),h=n(473),E=n(469),y=Object(O.a)("loadEventsRequest"),g=Object(O.a)("loadEventsSuccess"),w=Object(O.a)("loadEventsFailure"),C=Object(O.a)("editEvent"),D=Object(O.a)("deleteEvent"),k=Object(O.a)("addEvent"),x=Object(u.c)({isFetching:Object(v.a)({[y]:function(){return!0},[Object(j.a)(g,w)]:function(){return!1}},!1),error:Object(v.a)({[y]:function(){return null},[w]:function(e,t){return t}},null),eventTypes:Object(v.a)({[g]:function(e,t){return t.payload.eventTypes}},[]),persons:Object(v.a)({[g]:function(e,t){return t.payload.persons}},[]),toponyms:Object(v.a)({[g]:function(e,t){return t.payload.toponyms}},[]),events:Object(v.a)({[g]:function(e,t){return Object(h.a)(t.payload.events.map((function(e){return Object(m.a)(Object(m.a)({},e),{},{startDate:new Date(e.startDate),endDate:new Date(e.endDate)})})),(function(e){return e.endDate-e.startDate}),"desc")},[C]:function(e,t){return e.map((function(e){return e.id===t.payload.id?t.payload:e}))},[D]:function(e,t){return e.filter((function(e){return e.id!==t.payload.id}))},[k]:function(e,t){return[].concat(Object(d.a)(e),[Object(m.a)(Object(m.a)({},t.payload),{},{id:Object(E.a)()})])}},[])}),S=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,F=Object(u.e)(x,S(Object(u.a)(s.a))),_=n(89),I=n(39),N=n(470),T=n(68),L=n(488),M=n(486),q=n(479),A=n(244),R=n(485),B=function(e){return e.events},V=function(e){return e.toponyms},z=function(e){return e.persons},H=function(e){return e.eventTypes},K=function(e){return e.isFetching},P=function(e){return e.error},U=n(239),Y=n.n(U),J={align:"center",minHeight:"400px",maxHeight:"400px",type:"range",tooltip:{followMouse:!0,overflowMethod:"cap"},snap:null,orientation:{axis:"both"},zoomMin:432e6},X=function(){var e=Object(i.c)(B),t=Object(i.c)(H),n=Object(a.useMemo)((function(){return e.slice(0,10).map((function(e){return{start:e.startDate,end:e.endDate,content:e.name,duration:e.endDate-e.startDate,group:e.type,type:e.endDate-e.startDate<=864e5?"point":"range",title:(t=e,'\n  <div>\n    <h3 className="event-name">'.concat(t.name,'</h3>\n    <hr />\n    <div className="dates">\n      <div>\n        ').concat(t.startDate.toLocaleDateString()," - ").concat(t.endDate.toLocaleDateString(),"\n      </div>\n      <div>\n        <b>\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c: </b>\n        ").concat(Math.floor((t.endDate-t.startDate)/864e5)," \u0434\u043d.\n      </div>\n    </div>\n  </div>\n"))};var t}))}),[e]),o=Object(a.useMemo)((function(){return t.map((function(e){return{id:e.id,content:e.type}}))}),[t]);return r.a.createElement("div",null,n&&n.length>0&&r.a.createElement(Y.a,{options:J,items:n,groups:o}))},W=function(){var e=Object(i.c)(K),t=Object(i.c)(P);return r.a.createElement(N.a,null,r.a.createElement(q.a,{ghost:!1,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"}),r.a.createElement(N.a.Content,null,e&&r.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(A.a,{size:"large"})),t&&r.a.createElement(R.a,{message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",description:t,type:"error",showIcon:!0}),!e&&!t&&r.a.createElement(X,null)))},G=n(481),Q=n(47),Z=n(487),$=function(e){var t=e.filename,n=void 0===t?"events.json":t,a=Object(i.c)(B),o=Object(i.c)(H),c=Object(i.c)(z),l=Object(i.c)(V),u=JSON.stringify({events:a,eventTypes:o,toponyms:l,persons:c});return r.a.createElement(Q.a,{download:n,href:URL.createObjectURL(new Blob([u],{type:"application/json"}))},r.a.createElement(Z.a,null),"Export to json")},ee=n(484),te=n(471),ne=n(480),ae=n(474),re=function(e){return e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"})},oe=function(e){return e.type},ce=function(e){return e.map((function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)})).join()},ie=function(e){return e.map((function(e){return e.name})).join()},le=function(e,t){return e.startDate-t.startDate},ue=function(e,t){return e.endDate-t.endDate},se=function(e){var t=e.onAdd,n=e.onSelect,o=e.deleteRow,c=Object(a.useState)(""),l=Object(_.a)(c,2),u=l[0],s=l[1],d=Object(i.c)(H),p=Object(i.c)(z),b=Object(i.c)(V),f=Object(i.c)(B),O=Object(a.useMemo)((function(){return f.map((function(e){return Object(m.a)(Object(m.a)({},e),{},{type:d.find((function(t){return t.id===e.type})),persons:e.persons?e.persons.map((function(e){return p.find((function(t){return t.id===e}))})):[],toponyms:e.toponyms?e.toponyms.map((function(e){return b.find((function(t){return t.id===e}))})):[]})})).filter((function(e){return e.name.toLowerCase().includes(u.toLowerCase())}))}),[f,d,p,b,u]),v=Object(a.useCallback)((function(e){return{onClick:n?function(){return n(e)}:void 0}}),[n]),j=Object(a.useCallback)(Object(ee.a)((function(e){return s(e)})),[]);return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"10px 20px"}},r.a.createElement(Q.a,{type:"primary",onClick:t},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(ne.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:j,style:{width:400}})),r.a.createElement(ae.a,{dataSource:O,rowKey:function(e){return e.id},onRow:v},r.a.createElement(ae.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),r.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:le,render:re}),r.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:ue,render:re}),r.a.createElement(ae.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:d.map((function(e){return{value:e.id,text:e.type}})),onFilter:function(e,t){return t.type.id===e},render:oe}),r.a.createElement(ae.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:ce}),r.a.createElement(ae.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:ie}),r.a.createElement(ae.a.Column,{title:"",key:"delete",render:function(e,t){return r.a.createElement(te.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:function(e){e.stopPropagation(),o(t)},onCancel:function(e){e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442"},r.a.createElement(Q.a,{type:"link",onClick:function(e){e.stopPropagation()}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}})))},de=n(166),me=n(482),pe=n(476),be=n(64),fe=n.n(be),Oe=n(103),ve=n(147),je=n(475),he=function(e){var t=e.dateFormat,n=void 0===t?"DD.MM.YYYY":t,a=Object(Oe.a)(e,["dateFormat"]);return r.a.createElement(je.a,Object.assign({format:n},a))},Ee=n(135),ye=function(e){return e.id},ge=function(e){return e.name},we=[],Ce=function(e){var t=e.options,n=void 0===t?we:t,a=e.optionKeyFactory,o=void 0===a?ye:a,c=e.optionValueFactory,i=void 0===c?ye:c,l=e.optionNameFactory,u=void 0===l?ge:l,s=Object(Oe.a)(e,["options","optionKeyFactory","optionValueFactory","optionNameFactory"]);return r.a.createElement(Ee.a,s,n.map((function(e){return r.a.createElement(Ee.a.Option,{key:o(e),value:i(e)},u(e))})))},De=n(478),ke=[],xe=function(e){var t=e.allOptions,n=e.value,o=void 0===n?ke:n,c=e.onChange,i=e.placeholder,l=e.count,u=void 0===l?5:l,s=e.optionKeyFactory,m=void 0===s?ye:s,p=e.optionValueFactory,b=void 0===p?ye:p,f=e.optionNameFactory,O=void 0===f?ge:f,v=Object(a.useState)([]),j=Object(_.a)(v,2),h=j[0],E=j[1],y=Object(a.useCallback)(Object(ee.a)((function(e){E(t.filter((function(t){return O(t).toLowerCase().includes(e.toLocaleLowerCase())})))}),300),[t]),g=Object(a.useCallback)((function(){E([])}),[]),w=Object(a.useCallback)((function(e){E([]),c(e)}),[c]),C=Object(a.useMemo)((function(){return o.map((function(e){return t.find((function(t){return b(t)===e}))}))}),[t,o,b]),D=Object(a.useMemo)((function(){return h.length?h.slice(0,u):Object(De.a)([].concat(Object(d.a)(t.slice(0,u)),Object(d.a)(C)))}),[t,u,h,C]),k=Object(a.useMemo)((function(){return h.length?h.length-u:t.length-D.length}),[t,u,h,D.length]);return r.a.createElement(Ee.a,{placeholder:i,mode:"multiple",filterOption:!1,onSearch:y,onChange:w,onBlur:g,value:o},D.map((function(e){return r.a.createElement(Ee.a.Option,{key:m(e),value:b(e)},O(e))})),k>0&&r.a.createElement(Ee.a.Option,{key:"__hidedOptionsCount__",value:"__hidedOptionsCount__",disabled:!0},"\u0415\u0449\u0435 ",k," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"))},Se=function(e){return function(t){var n=t.name,a=t.label,o=t.validate,c=t.allowNull,i=void 0===c||c,l=t.format,u=void 0===l?ve.a:l,s=t.parse,d=void 0===s?ve.a:s,m=Object(Oe.a)(t,["name","label","validate","allowNull","format","parse"]);return r.a.createElement(de.a,{name:n,format:u,parse:d,allowNull:i,validate:o},(function(t){var n=t.input,o=n.value,c=n.onChange,i=n.onBlur,l=n.onFocus,u=t.meta,s=u.invalid,d=u.touched,p=u.error;return r.a.createElement(pe.a.Item,{label:a,validateStatus:d&&s?"error":"success",help:d&&s?p:void 0},r.a.createElement(e,Object.assign({value:o,onChange:c,onBlur:i,onFocus:l},m)))}))}},Fe=function(e){return function(t){var n=t.debounceTimeout,o=void 0===n?300:n,c=t.onChange,i=t.value,l=Object(Oe.a)(t,["debounceTimeout","onChange","value"]),u=Object(a.useState)(i),s=Object(_.a)(u,2),d=s[0],m=s[1],p=Object(a.useCallback)(Object(ee.a)((function(e){c(e)}),o),[]),b=Object(a.useCallback)((function(e){var t=e.target.value;m(t),p(t)}),[p]);return r.a.createElement(e,Object.assign({value:d,onChange:b},l))}},_e=(Se(Fe(ne.a)),Se(Fe(ne.a.TextArea))),Ie=Se(he),Ne=Se(Ce),Te=Se(xe),Le=n(472),Me=n(41),qe=function(e){return Object(Le.a)(e)||""===e||Object(Me.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0},Ae=function(e,t){return function(n,a){return n.isBefore(a[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0}},Re=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,a){return t.reduce((function(t,r){return t||r(e,n,a)}),void 0)}},Be=function(e){return e.type},Ve=function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)},ze={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]},He=function(e){var t=e.onSubmit,n=e.onClose,a=e.title,o=Object(i.c)(H),c=Object(i.c)(V),l=Object(i.c)(z),u=Object(i.c)(B),s=Object(I.j)().id;if(u.length<1)return r.a.createElement(me.a,{title:a,onClose:n,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0},r.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(A.a,{size:"large"})));var d=u.find((function(e){return e.id===Number(s)})),p=d?function(e){return Object(m.a)(Object(m.a)({},e),{},{startDate:fe()(e.startDate),endDate:fe()(e.endDate)})}(d):ze;return r.a.createElement(me.a,{title:a,onClose:n,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0},r.a.createElement(de.b,{initialValues:p,onSubmit:function(e){t(e)}},(function(e){var t,n,a=e.handleSubmit;return r.a.createElement(pe.a,{layout:"vertical",id:"edit_event_form",onFinish:a},r.a.createElement(pe.a.Item,null,r.a.createElement(_e,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:qe})),r.a.createElement(pe.a.Item,null,r.a.createElement(Ie,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:Re(qe,(t="endDate",n="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",function(e,a){return e.isAfter(a[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(n):void 0}))})),r.a.createElement(pe.a.Item,null,r.a.createElement(Ie,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:Re(qe,Ae("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})),r.a.createElement(pe.a.Item,null,r.a.createElement(Ne,{name:"type",label:"\u0422\u0438\u043f",options:o,optionNameFactory:Be,validate:qe})),r.a.createElement(pe.a.Item,null,r.a.createElement(Te,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:c,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})),r.a.createElement(pe.a.Item,null,r.a.createElement(Te,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:l,optionNameFactory:Ve,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})),r.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},r.a.createElement(Q.a,{htmlType:"submit",type:"primary"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")))})))},Ke="".concat("/editor","/add"),Pe="".concat("/editor","/edit/:id"),Ue=function(){var e=Object(i.b)(),t=Object(I.h)(),n=Object(a.useCallback)((function(e){t.push(Object(I.f)(Pe,{id:e.id}))}),[t]),o=Object(a.useCallback)((function(){t.push("/editor")}),[t]),c=Object(a.useCallback)((function(t){e(C(Object(m.a)(Object(m.a)({},t),{},{endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),o(),G.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e")}),[e,o]),l=Object(a.useCallback)((function(t){e(D(t))}),[e]),u=Object(a.useCallback)((function(t){e(k(Object(m.a)(Object(m.a)({},t),{},{id:Object(E.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),o(),G.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e")}),[o,e]),s=Object(a.useCallback)((function(){t.push(Ke)}),[t]);return r.a.createElement(N.a,null,r.a.createElement(q.a,{ghost:!1,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445",extra:r.a.createElement($,null)}),r.a.createElement(N.a.Content,null,r.a.createElement(se,{onAdd:s,onSelect:n,deleteRow:l}),r.a.createElement(I.b,{path:Ke,render:function(){return r.a.createElement(He,{onClose:o,onSubmit:u,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}}),r.a.createElement(I.b,{path:Pe,render:function(){return r.a.createElement(He,{onClose:o,onSubmit:c,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}})))},Ye=["/view","/editor"],Je=function(){var e=Object(a.useState)(!0),t=Object(_.a)(e,2),o=t[0],c=t[1],u=Object(i.b)(),s=Object(I.i)().pathname,d=Object(a.useMemo)((function(){return[Ye.find((function(e){return e===s}))]}),[s]);return Object(a.useEffect)((function(){u(function(){var e=Object(f.a)(b.a.mark((function e(t){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(y()),e.prev=1,e.next=4,n.e(3).then(n.t.bind(null,490,3));case 4:a=e.sent,t(g(a)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t(w(e.t0));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}())}),[u]),r.a.createElement(N.a,{style:{minHeight:"100vh"},hasSider:!0},r.a.createElement(N.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:o,onCollapse:c,style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},r.a.createElement(T.a,{theme:"dark",mode:"inline",selectedKeys:d},r.a.createElement(T.a.Item,{key:"/view"},r.a.createElement(l.b,{to:"/view"},r.a.createElement(L.a,null),r.a.createElement("span",null,"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"))),r.a.createElement(T.a.Item,{key:"/editor"},r.a.createElement(l.b,{to:"/editor"},r.a.createElement(M.a,null),r.a.createElement("span",null,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"))))),r.a.createElement(N.a,{style:{marginLeft:o?80:240,transition:"margin 0.2s"}},r.a.createElement(N.a.Content,null,r.a.createElement(I.d,null,r.a.createElement(I.b,{path:"/view",component:W}),r.a.createElement(I.b,{path:"/editor",component:Ue}),r.a.createElement(I.a,{to:"/view"})))))},Xe=(n(466),document.getElementById("root"));window.addEventListener("hashchange",(function(){window._paq.push(["setCustomUrl","/".concat(window.location.hash)]),window._paq.push(["setDocumentTitle",document.title]),window._paq.push(["trackPageView"]),window._paq.push(["FormAnalytics::scanForForms",Xe]),window._paq.push(["enableLinkTracking"]),window._paq.push(["trackContentImpressionsWithinNode",Xe])})),c.a.render(r.a.createElement(l.a,null,r.a.createElement(i.a,{store:F},r.a.createElement(Je,null))),Xe)}},[[269,1,2]]]);
//# sourceMappingURL=main.3af3ab15.chunk.js.map